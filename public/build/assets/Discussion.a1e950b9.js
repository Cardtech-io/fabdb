import{n as a,k as l,a as r,l as c,m,o}from"./app.452767c0.js";import{A as u}from"./Avatar.5513b82b.js";import{B as d}from"./Badge.c327b618.js";import{M as v}from"./Models.cc4dbaf5.js";const p={props:["comments"]};var _=function(){var t=this,e=t._self._c;return e("h2",{staticClass:"font-serif uppercase text-lg mt-4"},[t._v(t._s(t.comments?t.comments.length:0)+" comments.")])},f=[],h=a(p,_,f,!1,null,null,null,null);const g=h.exports;class i{constructor(t){this.fields=t}get author(){return this.fields.user}get name(){return this.fields.user.name||"Anonymous"}get slug(){return this.fields.slug}get when(){return l.utc(this.fields.createdAt).local().fromNow()}get content(){return this.fields.content}get subscription(){return this.fields.user.subscription}get myVote(){return this.fields.myVote||0}get totalVotes(){return this.fields.totalVotes||0}}const y={props:{direction:{type:String,required:!0,validator:function(s){return["up","down"].indexOf(s)!==-1}},size:{type:Number,required:!0}},computed:{classes(){return["h-"+this.size]}},methods:{vote(){let s={type:this.$parent.voteable,foreign:this.$parent.foreign,direction:this.direction};r.post("/vote",s).then(t=>{this.$emit("voted",s)})}}};var x=function(){var t=this,e=t._self._c;return e("button",{staticClass:"text-gray-400 hover:text-gray-800",on:{click:function(n){return t.vote()}}},[e("svg",{staticClass:"fill-current",class:t.classes,attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"}},[t.direction==="up"?e("path",{attrs:{d:"M11 0h1v3l3 7v8a2 2 0 01-2 2H5c-1.1 0-2.31-.84-2.7-1.88L0 12v-2a2 2 0 012-2h7V2a2 2 0 012-2zm6 10h3v10h-3V10z"}}):e("path",{attrs:{d:"M11 20a2 2 0 01-2-2v-6H2a2 2 0 01-2-2V8l2.3-6.12A3.11 3.11 0 015 0h8a2 2 0 012 2v8l-3 7v3h-1zm6-10V0h3v10h-3z"}})])])},C=[],$=a(y,x,C,!1,null,null,null,null);const b=$.exports,w={components:{Vote:b},props:{layout:{type:String,validator:function(s){return["vertical","horizontal"].indexOf(s)!==-1}},size:{type:Number,required:!0},total:{type:Number,required:!0},voteable:{type:String,required:!0},foreign:{type:String,required:!0},voted:{type:Number,required:!0}},data(){return{count:this.total,voteState:this.voted,previousDirection:null}},computed:{actualTotal(){return this.count<0?0:this.count}},methods:{handleVote(s){let t=s.direction==="down"?-1:1;this.voteState===t?this.voteState=0:this.voteState=t}}};var S=function(){var t=this,e=t._self._c;return e("div",{class:{flex:t.layout!=="vertical"}},[t.layout!=="vertical"?e("div",{staticClass:"text-xl mr-2 mt-1"},[t.total&&t.total>0?e("span",[t._v(t._s(t.actualTotal))]):t._e()]):t._e(),e("div",{staticClass:"mt-1",class:{flex:t.layout!=="vertical"}},[e("div",[e("vote",{class:{"text-gray-800":t.voteState===1},attrs:{size:t.size,direction:"up"},on:{voted:t.handleVote}})],1),t.layout==="vertical"?e("div",{staticClass:"text-center -mt-1"},[t.total&&t.total>0?e("span",[t._v(t._s(t.actualTotal))]):t._e()]):t._e()])])},V=[],q=a(w,S,V,!1,null,null,null,null);const z=q.exports,R={props:["comment"],components:{Avatar:u,Badge:d,Votes:z}};var N=function(){var t=this,e=t._self._c;return e("div",{staticClass:"my-4 sm:mx-0"},[e("div",{staticClass:"flex mb-4"},[e("div",{staticClass:"mr-4"},[e("avatar",{staticClass:"rounded-br-none",attrs:{user:t.comment.author,width:80}})],1),e("div",{staticClass:"mr-4"},[e("votes",{attrs:{size:4,total:t.comment.totalVotes,voted:t.comment.myVote,voteable:"comment",foreign:t.comment.slug,layout:"vertical"}})],1),e("div",{staticClass:"flex-1"},[e("header",{staticClass:"flex w-full"},[e("div",{staticClass:"flex items-center"},[e("span",{staticClass:"mr-4 font-bold"},[t._v(t._s(t.comment.name))]),t.comment.subscription?e("badge",{attrs:{"subscription-level":t.comment.subscription,size:"small"}}):t._e()],1),e("div",{staticClass:"text-gray-500 text-sm text-right"},[t._v(t._s(t.comment.createdAt))])]),e("div",{staticClass:"mt-2"},[t._v(t._s(t.comment.content))])])]),e("hr",{staticClass:"text-gray-500"})])},A=[],M=a(R,N,A,!1,null,null,null,null);const k=M.exports,F={props:["type","foreign"],components:{Submit:c},computed:{...m("session",["user"]),name:{get(){return this.user.name},set(s){this.setUserParam({param:"name",value:s}),this.nameRequiresSaving=!0}}},data(){return{content:null,nameRequiresSaving:!1,saving:!1}},methods:{...o("session",["setUserParam"]),...o("messages",["addMessage"]),save:function(){this.saving=!0,this.nameRequiresSaving&&r.put("/profile/name",{name:this.name}),r.post("/comments/",{type:this.type,foreign:this.foreign,content:this.content}).then(s=>{this.addMessage({status:"success",message:"Comment posted."}),this.saving=!1,this.content="",this.$emit("comment-posted",s.data)})}}};var D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"mt-4 sm:px-0"},[t.user?e("form",{on:{submit:function(n){return n.preventDefault(),t.save.apply(null,arguments)}}},[!t.user.name||t.nameRequiresSaving?e("div",{staticClass:"w-full"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"input focus:border-gray-500 py-3 px-4 rounded-lg",attrs:{type:"text",placeholder:"Name",required:""},domProps:{value:t.name},on:{input:function(n){n.target.composing||(t.name=n.target.value)}}})]):t._e(),e("div",{staticClass:"w-full mt-1"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"input focus:border-gray-500 py-3 px-4 rounded-lg",attrs:{type:"text",rows:"4",placeholder:"Type here to comment on this "+t.type+"."},domProps:{value:t.content},on:{input:function(n){n.target.composing||(t.content=n.target.value)}}})]),e("submit",{staticClass:"w-full sm:w-auto mt-2 mx-auto",attrs:{text:"Comment",disabled:t.saving}})],1):e("div",{staticClass:"text-center"},[t._v(" You must be "),e("router-link",{staticClass:"link",attrs:{to:"/login/?from="+t.$route.path}},[t._v("logged in")]),t._v(" to participate in discussions. ")],1)])},P=[],T=a(F,D,P,!1,null,null,null,null);const B=T.exports,H={props:{type:{type:String,required:!0},id:{type:String,required:!0}},components:{Comment:k,CommentCount:g,Respond:B},data(){return{comments:[]}},methods:{addComment(s){this.comments.push(new i(s))}},mounted(){r.get("/comments/"+this.type+"/"+this.id).then(s=>{this.comments=v.hydrateMany(s.data,i)})}};var O=function(){var t=this,e=t._self._c;return e("div",[e("comment-count",{attrs:{comments:t.comments}}),t.comments.length?e("div",t._l(t.comments,function(n){return e("comment",{key:n.slug,attrs:{comment:n}})}),1):t._e(),e("respond",{staticClass:"mt-8",attrs:{type:t.type,foreign:t.id},on:{"comment-posted":t.addComment}})],1)},U=[],G=a(H,O,U,!1,null,null,null,null);const I=G.exports;export{I as D,B as R,z as V};
